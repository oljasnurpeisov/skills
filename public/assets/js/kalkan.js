var debug=!0;function Kalkan(e,t,s,a,n){this.debug=s||!1,this.host=e||"127.0.0.1",this.port=t||"13579",this.onReady=a||null,this.onError=n||null,this.heartbeat_msg="--heartbeat--",this.heartbeat_interval=null,this.missed_heartbeats=0,this.missed_heartbeats_limit_min=300,this.missed_heartbeats_limit_max=5e3,this.missed_heartbeats_limit=this.missed_heartbeats_limit_min,this.callback=null,this.ready=null,this.storageName=null,this.fileExtension=null,this.currentDirectory=null,this.socket=this.getSocket();var o=this;this.socket.onopen=function(e){null===o.heartbeat_interval&&(o.missed_heartbeats=0,o.heartbeat_interval=setInterval(o.sendPing.bind(o),2e3)),console.log("Connection opened"),o.onReady&&o.onReady()},this.socket.onclose=function(e){e.wasClean?console.log("connection has been closed"):(console.log("Connection error"),o.onError&&o.onError()),console.log("Code: "+e.code+" Reason: "+e.reason),console.log(e)},this.socket.onmessage=function(e){if(e.data!==o.heartbeat_msg){var t=JSON.parse(e.data),s={result:t.result,secondResult:t.secondResult,errorCode:t.errorCode,responseObject:t.responseObject,message:t.message,getResult:function(){return this.result},getSecondResult:function(){return this.secondResult},getErrorCode:function(){return this.errorCode},getResponseObject:function(){return this.responseObject},getCode:function(){return this.code}};o.callback&&o.callback(s),o.setMissedHeartbeatsLimitToMin()}else o.missed_heartbeats=0}}Kalkan.prototype.getSocket=function(){return new WebSocket("wss://"+this.host+":"+this.port+"/")},Kalkan.prototype.setMissedHeartbeatsLimitToMax=function(){this.missed_heartbeats_limit=this.missed_heartbeats_limit_max},Kalkan.prototype.setMissedHeartbeatsLimitToMin=function(){this.missed_heartbeats_limit=this.missed_heartbeats_limit_min},Kalkan.prototype.sendMessage=function(e,t){this.callback=t,this.setMissedHeartbeatsLimitToMax(),this.socket.send(JSON.stringify(e))},Kalkan.prototype.sendPing=function(){console.log("pinging...");try{if(this.missed_heartbeats++,this.missed_heartbeats>=this.missed_heartbeats_limit)throw new Error("Too many missed heartbeats.");this.socket.send(this.heartbeat_msg)}catch(e){clearInterval(this.heartbeat_interval),this.heartbeat_interval=null,console.warn("Closing connection. Reason: "+e.message),this.socket.close()}},Kalkan.prototype.browseKeyStore=function(e,t,s,a){var n={method:"browseKeyStore",args:[e,t,s]};this.sendMessage(n,a)},Kalkan.prototype.checkNCAVersion=function(e){this.sendMessage({method:"checkNCAVersion",args:[]},e)},Kalkan.prototype.loadSlotList=function(e,t){var s={method:"loadSlotList",args:[e]};this.sendMessage(s,t)},Kalkan.prototype.showFileChooser=function(e,t,s){var a={method:"showFileChooser",args:[e,t]};this.sendMessage(a,s)},Kalkan.prototype.getKeys=function(e,t,s,a,n){var o={method:"getKeys",args:[e,t,s,a]};this.sendMessage(o,n)},Kalkan.prototype.getNotAfter=function(e,t,s,a,n){var o={method:"getNotAfter",args:[e,t,s,a]};this.sendMessage(o,n)},Kalkan.prototype.getNotBefore=function(e,t,s,a,n){var o={method:"getNotBefore",args:[e,t,s,a]};this.sendMessage(o,n)},Kalkan.prototype.getSubjectDN=function(e,t,s,a,n){var o={method:"getSubjectDN",args:[e,t,s,a]};this.sendMessage(o,n)},Kalkan.prototype.getIssuerDN=function(e,t,s,a,n){var o={method:"getIssuerDN",args:[e,t,s,a]};this.sendMessage(o,n)},Kalkan.prototype.getRdnByOid=function(e,t,s,a,n,o,i){var r={method:"getRdnByOid",args:[e,t,s,a,n,o]};this.sendMessage(r,i)},Kalkan.prototype.signPlainData=function(e,t,s,a,n,o){var i={method:"signPlainData",args:[e,t,s,a,n]};this.sendMessage(i,o)},Kalkan.prototype.verifyPlainData=function(e,t,s,a,n,o,i){var r={method:"verifyPlainData",args:[e,t,s,a,n,o]};this.sendMessage(r,i)},Kalkan.prototype.createCMSSignature=function(e,t,s,a,n,o,i){var r={method:"createCMSSignature",args:[e,t,s,a,n,o]};this.sendMessage(r,i)},Kalkan.prototype.createCMSSignatureFromFile=function(e,t,s,a,n,o,i){var r={method:"createCMSSignatureFromFile",args:[e,t,s,a,n,o]};this.sendMessage(r,i)},Kalkan.prototype.verifyCMSSignature=function(e,t,s){var a={method:"verifyCMSSignature",args:[e,t]};this.sendMessage(a,s)},Kalkan.prototype.verifyCMSSignatureFromFile=function(e,t,s){var a={method:"verifyCMSSignatureFromFile",args:[e,t]};this.sendMessage(a,s)},Kalkan.prototype.signXml=function(e,t,s,a,n,o){var i={method:"signXml",args:[e,t,s,a,n]};this.sendMessage(i,o)},Kalkan.prototype.signXmlByElementId=function(e,t,s,a,n,o,i,r,l){var h={method:"signXmlByElementId",args:[e,t,s,a,n,o,i,r]};this.sendMessage(h,l)},Kalkan.prototype.authXml=function(e,t,s,a){var n={module:"kz.gov.pki.knca.commonUtils",method:"signXml",args:[e,t,s,"",""]};this.sendMessage(n,a)},Kalkan.prototype.authXmls=function(e,t,s,a){var n={module:"kz.gov.pki.knca.commonUtils",method:"signXmls",args:[e,t,s,"",""]};this.sendMessage(n,a)},Kalkan.prototype.verifyXml=function(e,t){var s={method:"verifyXml",args:[e]};this.sendMessage(s,t)},Kalkan.prototype.verifyXmlById=function(e,t,s,a){var n={method:"verifyXml",args:[e,t,s]};this.sendMessage(n,a)},Kalkan.prototype.getHash=function(e,t,s){var a={method:"getHash",args:[e,t]};this.sendMessage(a,s)},Kalkan.prototype.runApplet=function(e,t){document.write("<p>hello</p>")};
