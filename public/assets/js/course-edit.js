let courseController=function(e,n){function t(){x.innerHTML="";let n=0,o=0;_.sort(function(e,n){return e.order-n.order}).forEach(function({id:i,name:a,itemType:u,lessons:d,collapsed:g,duration:b,type:T}){let L=document.createElement("div");if(L.className="topic",g&&L.classList.add("collapsed"),"theme"===u){if(L.innerHTML=`<div class="topic__header">\n                                    <div class="title">${a}</div>\n                                    <div class="duration"></div>\n                                    <div class="edit-buttons">\n                                        <a href="#" title="${v}" class="btn-icon small btn-icon--ghost icon-chevron-up"> </a>\n                                        <a href="#" title="${p}" class="btn-icon small btn-icon--ghost icon-trash-can"> </a>\n                                        <a href="#" title="${m}" class="btn-icon small btn-icon--ghost icon-chevron-down"> </a>\n                                        <a href="#" title="${h}" class="btn-icon small btn-icon--ghost icon-edit"> </a>\n                                        <a href="${`/${f}/my-courses/course/${e}/theme-${i}/create-lesson`}" title="${y}" class="btn-icon small icon-plus"> </a>\n                                    </div>\n                                </div>`,L.querySelector(".icon-trash-can").addEventListener("click",function(e){e.preventDefault(),C=i,$.fancybox.open({src:w,touch:!1})}),L.querySelector(".icon-edit").addEventListener("click",function(e){e.preventDefault(),N=i,E.value=a,$.fancybox.open({src:D,touch:!1})}),d){let s=L.querySelector(".title"),a=L.querySelector(".duration"),u=document.createElement("div"),y=0;L.classList.add("spoiler"),u.className="topic__body";let g=d.sort(function(e,n){return e.order-n.order});g.forEach(function({id:t,name:o,duration:c,type:s}){let a=document.createElement("div");a.className="lesson",a.innerHTML=`<div class="title"><a href="${`/${f}/my-courses/course/${e}/view-lesson-${t}`}" title="${o}">${o} <div class="type">${s}</div></a></div>\n                                      <div class="duration">${l(c)}</div>\n                                      <div class="edit-buttons">\n                                          <div class="united">\n                                              <a href="#" title="${v}" class="btn-icon btn-icon--ghost icon-chevron-up"> </a>\n                                              <a href="#" title="${p}" class="btn-icon btn-icon--ghost icon-trash-can"> </a>\n                                              <a href="#" title="${m}" class="btn-icon btn-icon--ghost icon-chevron-down"> </a>\n                                          </div>\n                                          <a href="${`/${f}/my-courses/course/${e}/edit-lesson-${t}`}" title="${h}" class="btn-icon btn-icon--ghost icon-edit"> </a>\n                                      </div>`,a.querySelector(".icon-chevron-up").addEventListener("click",function(e){e.preventDefault(),r(t,g,-1)}),a.querySelector(".icon-trash-can").addEventListener("click",function(e){e.preventDefault(),j=t,C=i,$.fancybox.open({src:k,touch:!1})}),a.querySelector(".icon-chevron-down").addEventListener("click",function(e){e.preventDefault(),r(t,g,1)}),y+=c,u.append(a),n++}),s.addEventListener("click",function(){L.classList.toggle("collapsed");let e=c(i,_);e.collapsed=!e.collapsed,t()}),a.innerHTML=l(y),o+=y,L.append(u)}}else L.innerHTML=`<div class="topic__header">\n                                    <div class="title"><a href="${`/${f}/my-courses/course/${e}/view-lesson-${i}`}" title="${a}">${a}</a><div class="type">${T}</div></div>\n                                    <div class="duration">${l(b)}</div>\n                                    <div class="edit-buttons">\n                                        <a href="#" title="${v}" class="btn-icon small btn-icon--ghost icon-chevron-up"> </a>\n                                        <a href="#" title="${p}" class="btn-icon small btn-icon--ghost icon-trash-can"> </a>\n                                        <a href="#" title="${m}" class="btn-icon small btn-icon--ghost icon-chevron-down"> </a>\n                                        <a href="${`/${f}/my-courses/course/${e}/edit-lesson-${i}`}" title="${h}" class="btn-icon small btn-icon--ghost icon-edit"> </a>\n                                        <span class="btn-icon small icon-plus invisible"> </span>\n                                    </div>\n                                </div>`,L.querySelector(".icon-trash-can").addEventListener("click",function(e){e.preventDefault(),j=i,$.fancybox.open({src:k,touch:!1})}),o+=b,n++;L.querySelector(".icon-chevron-up").addEventListener("click",function(e){e.preventDefault(),s(i,-1)}),L.querySelector(".icon-chevron-down").addEventListener("click",function(e){e.preventDefault(),s(i,1)}),x.append(L)}),H.innerHTML=n+"",M.innerHTML=l(o)}function o(e,n){let t=document.querySelector(I),o=t.querySelector(".title-primary"),c=t.querySelector(".plain-text");o.innerHTML=e,c.innerHTML=n,$.fancybox.open({src:I,touch:!1})}function c(e,n){return n.find(function(n){return n.id===+e})}function i(e,n){return n.findIndex(function(n){return n.id===+e})}function s(e,n){let o=c(e,_),i=_.find(function(e){return 1==(e.order-o.order)*n});i&&(u(),g.swapItems(o.id,o.itemType,i.id,i.itemType).then(function(){o.order+=n,i.order=o.order-n,t(),d()}).catch(function(e){console.log(e.message)}))}function r(e,n,o){let i=c(e,n),s=n.find(function(e){return 1==(e.order-i.order)*o});s&&(u(),g.swapLessonsOrders(i.id,s.id).then(function(){i.order+=o,s.order=i.order-o,t(),d()}).catch(function(e){console.log(e.message)}))}function l(e){return a(parseInt(e/60))+":"+a(e%60)}function a(e){return 1===(e+"").length?"0"+e:e+""}function u(){x.classList.add("loading-default")}function d(){x.classList.remove("loading-default")}const f=window.Laravel.lang,{upText:v,downText:m,deleteText:p,editText:h,addText:y}=n,g=new DataService,b=document.querySelector("#addTopicBtn"),T=document.querySelector("#editTopicBtn"),L=document.querySelector("#removeTopicBtn"),S=document.querySelector("#removeLessonBtn"),q=document.querySelector("#newTopicNameInput"),E=document.querySelector("#editTopicNameInput"),x=document.querySelector("#courseDataContainer"),D="#editTopicModal",w="#removeTopicModal",k="#removeLessonModal",M=document.querySelector("#courseDuration"),H=document.querySelector("#lessonsCount"),I="#modalMsg";let _=[],C=null,N=null,j=null;this.initComponent=function(){b.addEventListener("click",function(n){n.preventDefault();let o=q.value;return o?(q.parentElement.classList.remove("error"),void g.addTopic(e,o).then(function({id:e,name:n}){_.push(function(e,n){return{id:e,name:n,order:_.length,lessons:null,itemType:"theme"}}(e,n)),parent.jQuery.fancybox.getInstance().close(),t(),q.value=""}).catch(function(e){console.log(e.message)})):(q.parentElement.classList.add("error"),!1)}),T.addEventListener("click",function(e){e.preventDefault();let n=E.value;return n?(q.parentElement.classList.remove("error"),void g.editTopic(N,n).then(function({msgTitle:e,msgText:i}){parent.jQuery.fancybox.getInstance().close(),setTimeout(function(){o(e,i)},380),c(N,_).name=n,t()}).catch(function(e){console.log(e.message)})):(q.parentElement.classList.add("error"),!1)}),L.addEventListener("click",function(e){e.preventDefault(),g.removeTopic(C).then(function({msgTitle:e,msgText:n}){parent.jQuery.fancybox.getInstance().close(),setTimeout(function(){o(e,n)},380);let c=i(C,_);_.splice(c,1);for(let e=c;e<_.length;e++)_[e].order--;t()}).catch(function(e){console.log(e.message)})}),S.addEventListener("click",function(e){e.preventDefault(),g.removeLesson(C,j).then(function({msgTitle:e,msgText:n}){parent.jQuery.fancybox.getInstance().close(),setTimeout(function(){o(e,n)},380);let s=c(C,_).lessons,r=i(j,s);s.splice(r,1);for(let e=r;e<s.length;e++)s[e].order--;t()}).catch(function(e){console.log(e.message)})}),g.getCourseData(e).then(function(e){_=[...e],t()}).catch(function(e){console.log(e.message)})},this.renderData=function(){t()}};
